<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:cc="http://java.sun.com/jsf/composite/components"
                xmlns:sec="http://www.springframework.org/security/tags"
                template="/templates/main.xhtml">

    <ui:define name="title">
        <cc:titleText title="#{msg['pos']['branchInfo']}"/>
    </ui:define>

    <ui:define name="content">

        <style>
            .branchInfoDataTable table tbody td {
                white-space: normal;
                word-wrap: break-word;
            }
        </style>

        <script>
            function checkElementSelection() {
                if (PF('branchInfoDataTableVar').selection.length == 0) {
                    PF('infoDialog').show();
                    return false;
                } else {
                    return true;
                }
            }
        </script>

        <h:form id="branchInfoDataTableForm">

            <p:panel header="#{msg['common']['search']}" style="width: 100%;">
                <div class="ui-grid ui-grid-responsive">
                    <div class="ui-grid-row">
                        <div class="ui-grid-col-8">
                            <h:outputLabel for="name" value="#{msg['pos']['clientHost']}"/>
                            <p:inputText id="name"
                                         value="#{branchInfoController.dataModel.dataModelQuery.criteria.clientHostKeyword}"
                                         label="#{msg['common']['name']}" maxlength="100"
                                         style="width: 164px;"/>

                            <p:commandButton id="searchButton"
                                             value="#{msg['common']['search']}"
                                             update="branchInfoDataTable" icon="ui-icon-search1"
                                             style=" margin-left: 10px;"/>
                        </div>
                    </div>

                </div>
            </p:panel>

            <cc:spacer/>

            <p:toolbar id="toolbar">
                <p:toolbarGroup align="left">

                    <p:commandButton id="addBtn" value="#{msg['common']['add']}"
                                     process="@this" action="#{branchInfoController.add}"
                                     update=":branchInfoDialogForm"
                                     oncomplete="PF('branchInfoDialogVar').show();"
                                     icon="ui-icon-add"/>

                    <p:commandButton id="editBtn" value="#{msg['common']['edit']}"
                                     process="@form"
                                     update=":branchInfoDialogForm"
                                     oncomplete="PF('branchInfoDialogVar').show();" icon="ui-icon-edit"
                                     onclick="if (!checkDatatableSelection('branchInfoDataTableVar')) return false;"/>

                    <p:commandButton id="deleteBtn"
                                     value="#{msg['common']['delete']}" process="@form"
                                     action="#{branchInfoController.delete}"
                                     update=":branchInfoDataTableForm:branchInfoDataTable"
                                     icon="ui-icon-delete"
                                     onclick="if (!confirmDeleteDatatableRecord('branchInfoDataTableVar')) return false;"
                                     rendered="#{commonController.loginUser.isAdmin()}"/>

                </p:toolbarGroup>
            </p:toolbar>

            <cc:spacer height="3"/>

            <p:dataTable id="branchInfoDataTable" styleClass="branchInfoDataTable"
                         widgetVar="branchInfoDataTableVar" var="element"
                         value="#{branchInfoController.dataModel}"
                         selection="#{branchInfoController.branchInfo}"
                         paginator="true"
                         paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         rowsPerPageTemplate="15" rows="15" lazy="true" dynamic="true"
                         emptyMessage="#{msg['common']['noRecord']}" rowKey="#{element.id}">

                <f:facet name="header">
                    <p:graphicImage value="/images/record16.png"/>
                    <h:outputText value="#{msg['pos']['branchInfo']}"/>
                </f:facet>

                <p:column selectionMode="single" style="width:16px; text-align:center"/>

                <p:column headerText="#{msg['pos']['clientType']}">
                    <h:outputText value="#{element.clientType}"/>
                </p:column>
                <p:column headerText="#{msg['pos']['clientHost']}">
                    <h:outputText value="#{element.clientHost}"/>
                </p:column>
                <p:column headerText="#{msg['pos']['clientPort']}">
                    <h:outputText value="#{element.clientPort}"/>
                </p:column>
                <p:column headerText="#{msg['pos']['clientDB']}">
                    <h:outputText value="#{element.clientDB}"/>
                </p:column>
                <p:column headerText="#{msg['pos']['user']}">
                    <h:outputText value="#{element.user}"/>
                </p:column>
                <p:column headerText="#{msg['pos']['password']}">
                    <h:outputText value="#{element.password}"/>
                </p:column>
                <p:column headerText="#{msg['pos']['enable']}">
                    <h:outputText value="#{element.enable}"/>
                </p:column>

            </p:dataTable>

        </h:form>

    </ui:define>

    <ui:define name="dialog">
        <p:dialog id="branchInfoDialog"
                  widgetVar="branchInfoDialogVar" modal="true" width="600"
                  resizable="false">
            <f:facet name="header">
                <p:graphicImage value="/images/element16.png"/>
                <h:outputText value="#{msg['pos']['branchInfo']} #{msg['pos']['detail']}"/>
            </f:facet>
            <h:form id="branchInfoDialogForm">

                <h:panelGrid id="formPanel" columns="2"
                             columnClasses="panel-grid-col1,panel-grid-col2" cellpadding="5" style="width: 100%;"
                             rendered="#{branchInfoController.branchInfo != null}">

                    <h:outputLabel for="clientType" value="#{msg['pos']['clientType']}"/>
                    <p:inputText id="clientType" value="#{branchInfoController.branchInfo.clientType}"
                                 maxlength="500" style="width: 95%"/>
                    <h:outputLabel for="clientHost" value="#{msg['pos']['clientHost']}"/>
                    <p:inputText id="clientHost" value="#{branchInfoController.branchInfo.clientHost}"
                                 maxlength="500" style="width: 95%"/>
                    <h:outputLabel for="clientPort" value="#{msg['pos']['clientPort']}"/>
                    <p:inputText id="clientPort" value="#{branchInfoController.branchInfo.clientPort}"
                                 maxlength="500" style="width: 95%"/>
                    <h:outputLabel for="clientDB" value="#{msg['pos']['clientDB']}"/>
                    <p:inputText id="clientDB" value="#{branchInfoController.branchInfo.clientDB}"
                                 maxlength="500" style="width: 95%"/>
                    <h:outputLabel for="user" value="#{msg['pos']['user']}"/>
                    <p:inputText id="user" value="#{branchInfoController.branchInfo.user}"
                                 maxlength="500" style="width: 95%"/>
                    <h:outputLabel for="password" value="#{msg['pos']['password']}"/>
                    <p:inputText id="password" value="#{branchInfoController.branchInfo.password}" type="password"
                                 maxlength="500" style="width: 95%"/>
                    <h:outputLabel for="enable" value="#{msg['pos']['enable']}"/>
                    <p:inputSwitch id="enable" value="#{branchInfoController.branchInfo.enable}" />

                    <p:spacer/>
                    <h:panelGroup style="width: 95%; display: inline-block; text-align: right;">
                        <p:commandButton id="submitButton" value="#{msg['common']['save']}"
                                         actionListener="#{branchInfoController.save}"
                                         update="@form :branchInfoDataTableForm :primefaceMessages"
                                         oncomplete="handleComplete(xhr, status, args)"
                                         icon="ui-icon-save1" style=" margin-right: -7px;"/>
                    </h:panelGroup>

                </h:panelGrid>
            </h:form>
        </p:dialog>

        <script type="text/javascript">
            function handleComplete(xhr, status, args) {

                if (args.validationFailed) {
                    PF('branchInfoDialogVar').jq.effect("shake", {
                        times: 3
                    }, 100);

                } else {
                    PF('branchInfoDialogVar').hide();
                }
            }

            $(document).bind("keyup", function (evt) {
                if (27 == evt.keyCode) {
                    PF('branchInfoDialogVar').hide();
                }
            });
        </script>

    </ui:define>

</ui:composition>
