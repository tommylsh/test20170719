<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:cc="http://java.sun.com/jsf/composite/components"
	xmlns:sec="http://www.springframework.org/security/tags"
	template="/templates/main.xhtml">

	<ui:define name="title">
		<cc:titleText title="#{msg['pos']['applicationSetting']}" />
	</ui:define>

	<ui:define name="content">

		<style>

.applicationSettingDataTable table tbody td {
	white-space: normal;
	word-wrap: break-word;
}

</style>

		<script>
			function checkElementSelection() {
				if (PF('applicationSettingDataTableVar').selection.length == 0) {
					PF('infoDialog').show();
					return false;
				} else {
					return true;
				}
			}
		</script>

		<h:form id="applicationSettingDataTableForm">

			<p:panel header="#{msg['common']['search']}" style="width: 100%;">
				<div class="ui-grid ui-grid-responsive">
					<div class="ui-grid-row">
						<div class="ui-grid-col-8">
							<h:outputLabel for="name" value="#{msg['common']['code']}" />
							<p:inputText id="name"
								value="#{applicationSettingController.dataModel.dataModelQuery.criteria.codeKeyword}"
								label="#{msg['common']['name']}" maxlength="100"
								style="width: 164px;" />

							<p:commandButton id="searchButton"
								value="#{msg['common']['search']}"
								update="applicationSettingDataTable" icon="ui-icon-search1"
								style=" margin-left: 10px;" />
						</div>
					</div>

				</div>
			</p:panel>

			<cc:spacer />

			<p:toolbar id="toolbar">
				<p:toolbarGroup align="left">

					<p:commandButton id="addBtn" value="#{msg['common']['add']}"
						process="@this" action="#{applicationSettingController.add}"
						update=":applicationSettingDialogForm"
						oncomplete="PF('applicationSettingDialogVar').show();"
						icon="ui-icon-add" />

					<p:commandButton id="editBtn" value="#{msg['common']['edit']}"
						process="@form" 
						update=":applicationSettingDialogForm"
						oncomplete="PF('applicationSettingDialogVar').show();" icon="ui-icon-edit"
						onclick="if (!checkDatatableSelection('applicationSettingDataTableVar')) return false;" />
					
					<p:commandButton id="deleteBtn"
						value="#{msg['common']['delete']}" process="@form"
						action="#{applicationSettingController.delete}"
						update=":applicationSettingDataTableForm:applicationSettingDataTable"
						icon="ui-icon-delete"
						onclick="if (!confirmDeleteDatatableRecord('applicationSettingDataTableVar')) return false;" rendered="#{commonController.loginUser.isAdmin()}"/>

				</p:toolbarGroup>
			</p:toolbar>

			<cc:spacer height="3" />

			<p:dataTable id="applicationSettingDataTable" styleClass="applicationSettingDataTable"
				widgetVar="applicationSettingDataTableVar" var="element"
				value="#{applicationSettingController.dataModel}"
				selection="#{applicationSettingController.applicationSettingObject}"
				paginator="true"
				paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
				rowsPerPageTemplate="15" rows="15" lazy="true" dynamic="true"
				emptyMessage="#{msg['common']['noRecord']}" rowKey="#{element.id}">

				<f:facet name="header">
					<p:graphicImage value="/images/record16.png" />
					<h:outputText value="#{msg['pos']['applicationSetting']}" />
				</f:facet>

				<p:column selectionMode="single"
					style="width:16px; text-align:center" />

				<p:column headerText="#{msg['pos']['code']}">
					<h:outputText value="#{element.code}" />
				</p:column>

				<p:column headerText="#{msg['pos']['codeValue']}">
					<h:outputText value="#{element.codeValue}" />
				</p:column>

				<p:column headerText="#{msg['pos']['codeDescription']}">
					<h:outputText value="#{element.codeDescription}" />
				</p:column>

			</p:dataTable>

		</h:form>

	</ui:define>

	<ui:define name="dialog">
		<p:dialog id="applicationSettingDialog"
			widgetVar="applicationSettingDialogVar" modal="true" width="600"
			resizable="false">
			<f:facet name="header">
				<p:graphicImage value="/images/element16.png" />
				<h:outputText value="#{msg['pos']['applicationSetting']} #{msg['pos']['detail']}" />
			</f:facet>
			<h:form id="applicationSettingDialogForm">

				<h:panelGrid id="formPanel" columns="2"
					columnClasses="panel-grid-col1,panel-grid-col2" cellpadding="5"
					style="width: 100%;"
					rendered="#{applicationSettingController.applicationSettingObject != null}">

					<h:outputLabel for="code" value="#{msg['pos']['code']}" />
					<p:inputText id="code"
						value="#{applicationSettingController.applicationSettingObject.code}"
						label="#{msg['pos']['code']}" maxlength="100" style="width: 95%"
						required="true" disabled="#{applicationSettingController.applicationSettingObject.id != null and !commonController.loginUser.isAdmin()}" />

					<h:outputLabel for="codeValue" value="#{msg['pos']['codeValue']}" />
					<p:inputText id="codeValue"
						value="#{applicationSettingController.applicationSettingObject.codeValue}"
						label="#{msg['pos']['codeValue']}" maxlength="500"
						style="width: 95%" required="true" />

					<h:outputLabel for="codeDescription"
						value="#{msg['pos']['codeDescription']}" />
					<p:inputText id="codeDescription"
						value="#{applicationSettingController.applicationSettingObject.codeDescription}"
						label="#{msg['pos']['codeDescription']}" maxlength="500"
						style="width: 95%" />

					<p:spacer />
					<h:panelGroup
						style="width: 95%; display: inline-block; text-align: right;">
						<p:commandButton id="submitButton"
							value="#{msg['common']['save']}"
							actionListener="#{applicationSettingController.save}"
							update="@form :applicationSettingDataTableForm :primefaceMessages"
							oncomplete="handleComplete(xhr, status, args)"
							icon="ui-icon-save1" style=" margin-right: -7px;" />
					</h:panelGroup>

				</h:panelGrid>
			</h:form>
		</p:dialog>

		<script type="text/javascript">
			function handleComplete(xhr, status, args) {

				if (args.validationFailed) {
					PF('applicationSettingDialogVar').jq.effect("shake", {
						times : 3
					}, 100);

				} else {
					PF('applicationSettingDialogVar').hide();
				}
			}

			$(document).bind("keyup", function(evt) {
				if (27 == evt.keyCode) {
					PF('applicationSettingDialogVar').hide();
				}
			});
		</script>

	</ui:define>

</ui:composition>
