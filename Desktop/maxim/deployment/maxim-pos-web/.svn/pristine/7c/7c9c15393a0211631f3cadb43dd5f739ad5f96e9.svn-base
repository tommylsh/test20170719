<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:cc="http://java.sun.com/jsf/composite/components"
                xmlns:sec="http://www.springframework.org/security/tags"
                template="/templates/main.xhtml">

    <ui:define name="title">
        <cc:titleText title="#{msg['pos']['branchScheme']}"/>
    </ui:define>

    <ui:define name="content">

        <style>
            .branchSchemeDataTable table tbody td {
                white-space: normal;
                word-wrap: break-word;
            }
        </style>


        <h:form id="branchSchemeDataTableForm1">
            <p:dataTable id="branchSchemeDataTable1" styleClass="branchSchemeDataTable"
                         widgetVar="branchSchemeDataTableVar" var="element"
                         value="#{systemDashboardController.dataModel}"
                         selection="#{systemDashboardController.systemDashboard}"
                         paginator="true"
                         paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         rowsPerPageTemplate="5" rows="5" lazy="true" dynamic="true"
                         emptyMessage="#{msg['common']['noRecord']}" rowKey="#{element.id}">

                <f:facet name="header">
                    <p:graphicImage value="/images/record16.png"/>
                    <h:outputText value="#{msg['pos']['Active Main Schedulers']}"/>
                </f:facet>

                <p:column headerText="#{msg['pos']['jobName']}">
                    <h:outputText value="#{element.jobName}"/>
                </p:column>

                <p:column headerText="#{msg['pos']['jobDesc']}">
                    <h:outputText value="#{element.jobDesc}"/>
                </p:column>

                <p:column headerText="#{msg['pos']['startTime']}">
                    <h:outputText value="#{element.startTime}">
                        <f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss"/>
                    </h:outputText>
                </p:column>

                <p:column headerText="#{msg['pos']['endTime']}">
                    <h:outputText value="#{element.endTime}">
                        <f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss"/>
                    </h:outputText>
                </p:column>

                <p:column headerText="#{msg['pos']['latestRunStatus']}">
                    <h:outputText value="#{element.status}"/>
                </p:column>

                <p:column headerText="#{msg['pos']['numOfScheme']}">
                    <h:outputText value="#{element.numOfScheme}"/>
                </p:column>

            </p:dataTable>

        </h:form>


        <cc:spacer height="20"/>


        <h:form id="applicationSettingDataTableForm">

            <p:panel header="#{msg['common']['search']}" style="width: 100%;">
                <div class="ui-grid-row">
                    <div class="ui-grid-col-8">
                        <h:outputLabel for="systemDate" value="System Date"/>

                        <p:calendar id="systemDate"
                                    value="#{eodProcessController.dataModel.dataModelQuery.criteria.startTime}"
                                    pattern="yyyy-MM-dd" />
                    </div>
                </div>
                <div class="ui-grid-row">
                <div class="ui-grid-col-8">
                    <h:outputLabel for="branchcode" value="Branch Code" />
                    <p:inputText id="branchcode"
                                 value="#{eodProcessController.dataModel.dataModelQuery.criteria.branchCode}"
                                  maxlength="200"
                                 style="width: 150px;" />
                </div>
                </div>
                <div class="ui-grid-row">
                    <div class="ui-grid-col-8">
                        <h:outputLabel for="pollSchemeType" value="#{msg['pos']['pollSchemeType']}"/>
                        <p:selectOneMenu id="pollSchemeType"
                                         value="#{eodProcessController.dataModel.dataModelQuery.criteria.pollSchemeType}"
                                         filter="false" required="false" style="width: 130px;">
                            <f:selectItem itemLabel="Please Select" itemValue=""/>
                            <f:selectItem itemLabel="SALES_EOD" itemValue="SALES_EOD"/>
                            <f:selectItem itemLabel="MASTER" itemValue="MASTER"/>
                        </p:selectOneMenu>

                        <p:commandButton id="searchButton"
                                         value="#{msg['common']['search']}"
                                         update="applicationSettingDataTable" icon="ui-icon-search1"
                                         style=" margin-left: 10px;"/>
                    </div>
                </div>

            </p:panel>

            <cc:spacer/>

            <p:toolbar id="toolbar">
                <p:toolbarGroup align="left">


                    <p:commandButton id="editBtn" value="ReRun"
                                     process="@form"
                                     update=":applicationSettingDialogForm"
                                     oncomplete="PF('applicationSettingDialogVar').show();" icon="ui-icon-edit"
                                     onclick="if (!checkDatatableSelection('applicationSettingDataTableVar')) return false;"/>


                </p:toolbarGroup>
            </p:toolbar>

            <cc:spacer height="3"/>

            <p:dataTable id="applicationSettingDataTable" styleClass="applicationSettingDataTable"
                         widgetVar="applicationSettingDataTableVar" var="element"
                         value="#{eodProcessController.dataModel}"
                         selection="#{eodProcessController.taskJobLog}"
                         paginator="true"
                         paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         rowsPerPageTemplate="15" rows="15" lazy="true" dynamic="true"
                         emptyMessage="#{msg['common']['noRecord']}" rowKey="#{element.id}">

                <f:facet name="header">
                    <p:graphicImage value="/images/record16.png"/>
                    <h:outputText value="Eod Process"/>
                </f:facet>

                <p:column selectionMode="single"
                          style="width:16px; text-align:center"/>

                <p:column headerText="Branch Code">
                    <h:outputText value="#{element.branchCode}"/>
                </p:column>
                <p:column headerText="Polling Scheme">
                    <h:outputText value="#{element.branchScheme.pollSchemeType}"/>
                </p:column>

                <p:column headerText="Direction">
                    <h:outputText value="#{element.direction}"/>
                </p:column>

                <p:column headerText="Start Time">
                    <h:outputText value="#{element.startTime}"/>
                </p:column>

                <p:column headerText="End Time">
                    <h:outputText value="#{element.endTime}"/>
                </p:column>

                <p:column headerText="Latest Run Status">
                    <h:outputText value="#{element.status}"/>
                </p:column>

                <p:column headerText="Error Code">
                    <h:outputText value="#{element.errorCode}"/>
                </p:column>

                <p:column headerText="Error Message">
                    <h:outputText value="#{element.errorMsg}"/>
                </p:column>

            </p:dataTable>

        </h:form>

    </ui:define>


    <ui:define name="dialog">
        <p:dialog id="applicationSettingDialog"
                  widgetVar="applicationSettingDialogVar" modal="true" width="600"
                  resizable="false">
            <f:facet name="header">
                <p:graphicImage value="/images/element16.png"/>
                <h:outputText value="ReRun Scheme"/>
            </f:facet>
            <h:form id="applicationSettingDialogForm">

                <h:panelGrid id="formPanel" columns="2"
                             columnClasses="panel-grid-col1,panel-grid-col2" cellpadding="5"
                             style="width: 100%;"
                             rendered="#{eodProcessController.taskJobLog != null}">

                    <h:outputLabel for="name" value="Scheme Name"/>
                    <p:inputText id="name"
                                 value="#{eodProcessController.taskJobLog.branchScheme.pollSchemeName}"
                                 label="#{msg['pos']['code']}" maxlength="100" style="width: 95%"
                                 required="true" readonly="true"/>

                    <h:outputLabel for="code" value="Branch Code"/>
                    <p:inputText id="code"
                                 value="#{eodProcessController.taskJobLog.branchScheme.branchMaster.branchCode}"
                                 label="#{msg['pos']['code']}" maxlength="100" style="width: 95%"
                                 required="true" readonly="true"/>

                    <h:outputLabel for="pst" value="Scheme Type"/>
                    <p:inputText id="pst"
                                 value="#{eodProcessController.taskJobLog.branchScheme.pollSchemeType}"
                                 label="#{msg['pos']['code']}" maxlength="100" style="width: 95%"
                                 required="true" readonly="true"/>


                    <h:outputLabel for="direction" value="Direction"/>
                    <p:inputText id="direction"
                                 value="#{eodProcessController.taskJobLog.branchScheme.direction}"
                                 label="#{msg['pos']['code']}" maxlength="100" style="width: 95%"
                                 required="true" readonly="true"/>


                    <h:outputLabel for="businessdate" value="Business Date" />
                    <p:calendar id="businessdate" value="#{eodProcessController.taskJobLog.branchScheme.businessDate}"
                                maxlength="500"
                                requiredMessage="Business Date is Must" required="true"
                                pattern="yyyy-MM-dd" />
                    <p:spacer/>
                    <h:panelGroup
                            style="width: 95%; display: inline-block; text-align: right;">
                        <p:commandButton id="submitButton"
                                         value="Re Run"
                                         actionListener="#{eodProcessController.reRun}"
                                         update="@form :applicationSettingDataTableForm :primefaceMessages"
                                         oncomplete="handleComplete(xhr, status, args)"
                                         icon="ui-icon-save1" style=" margin-right: -7px;"/>
                    </h:panelGroup>

                </h:panelGrid>
            </h:form>
        </p:dialog>

        <script type="text/javascript">
            function handleComplete(xhr, status, args) {

                if (args.validationFailed) {
                    PF('applicationSettingDialogVar').jq.effect("shake", {
                        times: 3
                    }, 100);

                } else {
                    PF('applicationSettingDialogVar').hide();
                }
            }

            $(document).bind("keyup", function (evt) {
                if (27 == evt.keyCode) {
                    PF('applicationSettingDialogVar').hide();
                }
            });
        </script>

    </ui:define>


</ui:composition>
